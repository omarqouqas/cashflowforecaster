# UX/UI Audit Recommendations

**Date:** January 19, 2026
**Auditor:** Claude Opus 4.5
**Status:** Pending Implementation

---

## Overview

This document contains prioritized bug fixes, UI/UX improvements, and workflow enhancements identified through a comprehensive codebase audit. Issues are organized by urgency and impact.

---

## Critical (Fix Before Launch Push)

### 1. Race Condition in Invoice Number Generation

**File:** `lib/actions/invoices.ts:60-72`

**Issue:** Invoice numbers are generated by querying the last invoice. Two simultaneous requests could generate duplicate `INV-0007`. This will cause data integrity issues and confuse users.

**Fix:** Use a database sequence or atomic counter, or implement optimistic locking.

**Priority:** Critical
**Effort:** Medium
**Status:** [ ] Not Started

---

### 2. Silent Failures in Onboarding

**File:** `app/onboarding/page.tsx:49-51`

**Issue:** `loadPersisted()` catches JSON parsing errors silently. Users lose their onboarding progress with no explanation, leading to abandonment.

**Fix:** Show toast notification on parse failure and offer to restart fresh.

**Priority:** Critical
**Effort:** Low
**Status:** [ ] Not Started

---

### 3. Calendar Generation Failure = Blank Dashboard

**File:** `app/dashboard/page.tsx:76-79`

**Issue:** If `generateCalendar()` throws, the dashboard shows nothing. Users see a blank page with no error message.

**Fix:** Add error boundary with user-friendly fallback: "We couldn't load your forecast. Try refreshing or contact support."

**Priority:** Critical
**Effort:** Low
**Status:** [ ] Not Started

---

### 4. Partial Import Creates Orphaned Data

**File:** `components/import/import-page-client.tsx:317-322`

**Issue:** If income insert fails but bills succeeded, the function returns early with a generic error. The `imported_transactions` table may have orphaned records. Users have no idea what actually imported.

**Fix:** Use a transaction or show exactly what succeeded/failed: "Imported 12 bills, 0 income (failed: invalid date format)"

**Priority:** Critical
**Effort:** Medium
**Status:** [ ] Not Started

---

### 5. No File Size Check on CSV Upload

**File:** `components/import/csv-upload.tsx:28`

**Issue:** `file.text()` is called without checking file size. A 50MB CSV could crash the browser tab.

**Fix:** Add file size validation:
```typescript
if (file.size > 5_000_000) {
  showError('File too large. Max 5MB.');
  return;
}
```

**Priority:** Critical
**Effort:** Low
**Status:** [ ] Not Started

---

## High Priority (Fix Within 2 Weeks)

### 6. Accessibility Gaps

**Multiple files across the codebase**

| Issue | Location | Impact |
|-------|----------|--------|
| Calendar days have no aria-labels | `calendar-view.tsx:256-280` | Screen readers can't navigate calendar |
| Form errors not associated with inputs | `new-invoice-form.tsx:138` | Assistive tech can't link errors to fields |
| Modal has no focus trap | `scenario-modal.tsx:75-83` | Keyboard users get lost |
| Button focus ring barely visible | `button.tsx:50` | `ring-zinc-900` invisible on dark bg |

**Why it matters:** ADA compliance risk, and 15% of the target market has some form of disability.

**Fix:**
- Add `aria-label` to calendar days: `aria-label="December 25, Monday, $1,500 balance"`
- Add `aria-describedby` to form inputs linking to error messages
- Implement focus trap in modals using `@radix-ui/react-focus-scope` or similar
- Change button focus ring to `focus:ring-teal-500` for visibility

**Priority:** High
**Effort:** Medium
**Status:** [ ] Not Started

---

### 7. Invoice Table Overflows on Mobile

**File:** `components/invoices/invoices-content.tsx:206-271`

**Issue:** 6-column table with `min-w-full` breaks on mobile - no horizontal scroll wrapper. Users can't see their invoices on phones.

**Fix:** Wrap in `<div className="overflow-x-auto">` or switch to card layout on mobile.

**Priority:** High
**Effort:** Low
**Status:** [ ] Not Started

---

### 8. Date Validation Allows Past Dates

**File:** `components/invoices/new-invoice-form.tsx:15-35`

**Issue:** Users can create invoices due yesterday. Schema is just `z.string().min(1)` - no date validation.

**Fix:**
```typescript
due_date: z.string().min(1).refine(
  (date) => new Date(date) >= new Date(new Date().setHours(0,0,0,0)),
  'Due date cannot be in the past'
)
```

**Priority:** High
**Effort:** Low
**Status:** [ ] Not Started

---

### 9. Amount Validation Allows $0 Invoices

**File:** `components/invoices/new-invoice-form.tsx`

**Issue:** `z.coerce.number().positive()` allows `0.001` which rounds to $0.00 in display. Users can send $0 invoices.

**Fix:** `.refine((n) => n >= 0.01, 'Amount must be at least $0.01')`

**Priority:** High
**Effort:** Low
**Status:** [ ] Not Started

---

### 10. Email Validation Duplicated 3 Times

**Files:**
- `send-invoice.ts:24`
- `send-invoice-button.tsx:21-22`
- `new-invoice-form.tsx:24`

**Issue:** Same regex copied three places. When you need to update it, you'll miss one.

**Fix:** Create `lib/validations/email.ts` with shared `emailSchema`:
```typescript
// lib/validations/email.ts
import { z } from 'zod';

export const emailSchema = z.string().email('Please enter a valid email address');
```

**Priority:** High
**Effort:** Low
**Status:** [ ] Not Started

---

## Medium Priority (Polish Phase)

### 11. No Loading Skeletons on Dashboard

**File:** `app/dashboard/page.tsx:19-49`

**Issue:** Dashboard data fetches with no skeleton UI. Page is blank while loading, feels broken.

**Fix:** Add `<Suspense fallback={<DashboardSkeleton />}>` pattern.

**Priority:** Medium
**Effort:** Medium
**Status:** [ ] Not Started

---

### 12. Touch Targets Below iOS Guidelines

**File:** `components/invoices/new-invoice-form.tsx:248-264`

**Issue:** Net-15/30/60 buttons are `px-3 py-1.5` (~28px height). Apple HIG recommends 44px minimum.

**Fix:** Use `min-h-[44px]` on all interactive elements.

**Priority:** Medium
**Effort:** Low
**Status:** [ ] Not Started

---

### 13. Inconsistent Button Padding

**Multiple files:**
- `new-invoice-form.tsx`: `px-4 py-2.5`
- `button.tsx`: `px-3` (sm), `px-4` (md)
- `send-invoice-button.tsx`: `px-3 py-1.5`

**Fix:** Standardize on design system sizes: `sm`, `md`, `lg` variants only.

**Priority:** Medium
**Effort:** Medium
**Status:** [ ] Not Started

---

### 14. Calendar Re-renders All Days on Selection

**File:** `components/calendar/calendar-view.tsx:256-282`

**Issue:** Clicking one day re-renders all 60+ day cards. No `React.memo` optimization.

**Fix:** Wrap `DayCard` in `React.memo` with proper comparison function:
```typescript
const MemoizedDayCard = React.memo(DayCard, (prev, next) => {
  return prev.day.date === next.day.date &&
         prev.isSelected === next.isSelected &&
         prev.day.balance === next.day.balance;
});
```

**Priority:** Medium
**Effort:** Low
**Status:** [ ] Not Started

---

### 15. Import Shows No Failed Row Details

**File:** `components/import/import-page-client.tsx:139-166`

**Issue:** When rows fail validation, they're silently dropped. User imports 500 rows, 487 succeed, but they never know which 13 failed or why.

**Fix:** Show validation errors: "Skipped 13 rows: 8 invalid dates, 5 missing amounts"

**Priority:** Medium
**Effort:** Medium
**Status:** [ ] Not Started

---

## Low Priority (Nice to Have)

### 16. No Currency Formatting in Amount Inputs

**File:** `components/onboarding/step-account.tsx:108`

**Issue:** Users type "1500" not "$1,500.00". No input masking for clarity.

**Fix:** Add currency input masking library or custom formatter.

**Priority:** Low
**Effort:** Medium
**Status:** [ ] Not Started

---

### 17. Onboarding Skip vs Continue Look Identical

**File:** `app/onboarding/page.tsx:185-190`

**Issue:** Both buttons look the same. Skip should be ghost/outline style.

**Fix:** Use `variant="ghost"` or `variant="outline"` for Skip button.

**Priority:** Low
**Effort:** Low
**Status:** [ ] Not Started

---

### 18. Session Storage Fails Silently in Private Mode

**File:** `app/onboarding/page.tsx:32-52`

**Issue:** Private browsing blocks sessionStorage. Users lose onboarding progress with no warning.

**Fix:** Detect storage availability, warn users, or use server-side state:
```typescript
function isStorageAvailable() {
  try {
    sessionStorage.setItem('test', 'test');
    sessionStorage.removeItem('test');
    return true;
  } catch {
    return false;
  }
}
```

**Priority:** Low
**Effort:** Medium
**Status:** [ ] Not Started

---

### 19. Duplicate Detection Only Checks Last 500

**File:** `components/import/import-page-client.tsx:152-157`

**Issue:** User imports same CSV a year later = duplicates. Detection window too small.

**Fix:** Hash-based dedup (hash of date+description+amount) stored permanently in database.

**Priority:** Low
**Effort:** High
**Status:** [ ] Not Started

---

### 20. No Retry for Failed Payments

**File:** `lib/actions/stripe.ts`

**Issue:** Single payment failure shows error with no retry button. User has to restart checkout.

**Fix:** Add "Try Again" button that re-initiates checkout session.

**Priority:** Low
**Effort:** Low
**Status:** [ ] Not Started

---

## Summary Matrix

| Category | Critical | High | Medium | Low |
|----------|----------|------|--------|-----|
| Error Handling | 4 | 1 | 1 | 1 |
| Accessibility | 0 | 4 | 0 | 0 |
| Mobile UX | 0 | 2 | 1 | 0 |
| Data Validation | 1 | 3 | 0 | 1 |
| Performance | 0 | 0 | 2 | 0 |
| Visual Polish | 0 | 0 | 2 | 3 |

---

## Top 5 Recommendations (Ranked)

1. **Fix invoice number race condition** - Data integrity issue that will bite you at scale
2. **Add error boundaries + user feedback** - Silent failures = support tickets + churn
3. **Mobile table overflow + touch targets** - Your target market uses phones
4. **Accessibility audit** - Legal risk + excludes 15% of potential users
5. **Validation consistency** - Centralize schemas to prevent bugs

---

## Implementation Tracking

### Completed
- [x] #1 - Race condition in invoice number generation (uses MAX + retry logic)
- [x] #2 - Silent failures in onboarding (shows toast on storage/parse errors)
- [x] #3 - Calendar generation error handling (shows user-friendly error with refresh button)
- [x] #4 - Partial import orphaned data (shows detailed success/failure info)
- [x] #5 - File size check on CSV upload (5MB limit with clear error)
- [x] #6 - Button focus ring visibility (changed to teal-500)
- [x] #7 - Invoice table mobile overflow (already had overflow-x-auto)
- [x] #8 - Date validation for invoices (no past dates allowed)
- [x] #9 - Amount validation (minimum $0.01)
- [x] #10 - Centralized email validation (created lib/validations/email.ts)

### In Progress
- [ ] None

### Remaining (Lower Priority)
- [ ] #11 - Dashboard loading skeletons
- [ ] #12 - Touch targets for mobile
- [ ] #13 - Inconsistent button padding
- [ ] #14 - Calendar re-render optimization
- [ ] #15 - Import failed row details
- [ ] #16-20 - Low priority polish items

---

## Changelog

| Date | Change |
|------|--------|
| 2026-01-19 | Initial audit completed |
| 2026-01-19 | Fixed 10 critical/high priority issues (#1-10) |

---

*This document should be updated as issues are resolved.*
